<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¸…å–®ï½œå¾…è²·å‹¾é¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="topbar">
  <div class="wrap topbar__inner">
    <div class="brand">
      <div class="brand__title">æ¸…å–®</div>
      <div class="brand__sub">å¿«é€Ÿå‹¾é¸ã€Œå·²è²·åˆ°ã€ï½œè‡ªå‹•ä¿å­˜ï¼ˆæœ¬æ©Ÿç€è¦½å™¨ï¼‰</div>
    </div>
    <nav class="nav">
      <a class="nav__link" href="index.html">Home</a>
      <a class="nav__link" href="day1.html">Day 1</a>
      <a class="nav__link" href="day2.html">Day 2</a>
      <a class="nav__link" href="day3.html">Day 3</a>
      <a class="nav__link" href="day4.html">Day 4</a>
      <a class="nav__link" href="day5.html">Day 5</a>
      <a class="nav__link" href="day6.html">Day 6</a>
      <a class="nav__link" href="checklist.html">æ¸…å–®</a>
      <a class="nav__link" href="ledger.html">è¨˜å¸³</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="dayHead">
    <h1 class="dayHead__title">å¾…è²·æ¸…å–®</h1>
    <div class="dayHead__sub">âœ… å‹¾é¸å³ä¿å­˜ï½œâ• å¯æ–°å¢é …ç›®ï½œğŸ§¹ å¯ä¸€éµæ¸…ç©ºå·²å®Œæˆ</div>
  </div>

  <section>
    <div class="section-header h-plan">ğŸ§¾ å¿«é€Ÿæ–°å¢</div>
    <div class="section-card">
      <div class="grid3">
        <input id="itemName" class="smallInput" placeholder="å“åï¼ˆä¾‹å¦‚ï¼šè—¥å¦ã€ä¼´æ‰‹ç¦®ã€å¡ç‰‡åŒ…â€¦ï¼‰" />
        <input id="itemNote" class="smallInput" placeholder="å‚™è¨»ï¼ˆå¯ç©ºç™½ï¼Œä¾‹å¦‚ï¼šå°ºå¯¸/å£å‘³/åº—åï¼‰" />
        <button id="addBtn" class="btn">â• åŠ å…¥æ¸…å–®</button>
      </div>
      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
        <button id="clearDoneBtn" class="btn secondary">ğŸ§¹ æ¸…é™¤å·²å®Œæˆ</button>
        <button id="resetAllBtn" class="btn secondary">â™»ï¸ é‡ç½®å…¨éƒ¨</button>
        <span class="badge">æç¤ºï¼šè³‡æ–™å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ï¼ˆæ›æ‰‹æ©Ÿä¸æœƒåŒæ­¥ï¼‰</span>
      </div>
    </div>
  </section>

  <section style="margin-top:14px;">
    <div class="section-header h-spot">ğŸ› æ¸…å–®å…§å®¹</div>
    <div class="section-card">
      <div class="kv">
        <div class="kv__left">
          <p class="kv__k">ğŸ“Œ é€²åº¦</p>
          <p class="kv__v"><span id="progressText">0 / 0</span></p>
        </div>
        <div class="badges">
          <span class="badge badge--money">å·²å®Œæˆï¼š<span id="doneCount">0</span></span>
          <span class="badge">æœªå®Œæˆï¼š<span id="todoCount">0</span></span>
        </div>
      </div>

      <div id="list" class="rows" style="margin-top:12px;"></div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer__inner">
      <a href="index.html">â† Home</a><span class="sep">Â·</span>
      <a href="ledger.html">å»è¨˜å¸³ â†’</a>
    </div>
  </footer>
</main>

<script src="script.js"></script>
<script>
  const KEY = "jp2026_checklist_v1";

  const defaultItems = [
    { id: crypto.randomUUID(), name: "ä¼´æ‰‹ç¦®", note: "æƒ³è²·å†ç´°åŒ–", done: false },
    { id: crypto.randomUUID(), name: "è—¥å¦è£œè²¨", note: "OS Drug / å…¶ä»–è—¥å±€", done: false },
    { id: crypto.randomUUID(), name: "æ‰­è›‹ / å¡åº—å°ç‰©", note: "ç§‹è‘‰åŸ", done: false },
  ];

  function load() {
    try {
      const raw = localStorage.getItem(KEY);
      if (!raw) return defaultItems;
      const data = JSON.parse(raw);
      return Array.isArray(data) ? data : defaultItems;
    } catch {
      return defaultItems;
    }
  }

  function save(items) {
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  let items = load();

  const $list = document.getElementById("list");
  const $itemName = document.getElementById("itemName");
  const $itemNote = document.getElementById("itemNote");
  const $addBtn = document.getElementById("addBtn");
  const $clearDoneBtn = document.getElementById("clearDoneBtn");
  const $resetAllBtn = document.getElementById("resetAllBtn");
  const $progressText = document.getElementById("progressText");
  const $doneCount = document.getElementById("doneCount");
  const $todoCount = document.getElementById("todoCount");

  function render() {
    $list.innerHTML = "";

    const done = items.filter(x => x.done).length;
    const total = items.length;
    $progressText.textContent = `${done} / ${total}`;
    $doneCount.textContent = done;
    $todoCount.textContent = total - done;

    if (items.length === 0) {
      const empty = document.createElement("div");
      empty.className = "row row--soft";
      empty.innerHTML = `
        <div class="row__icon">ğŸ«§</div>
        <div class="row__body">
          <p class="row__title">ç›®å‰æ²’æœ‰é …ç›®</p>
          <p class="row__meta">åœ¨ä¸Šæ–¹è¼¸å…¥å“åï¼ŒæŒ‰ã€ŒåŠ å…¥æ¸…å–®ã€å°±å¯ä»¥é–‹å§‹å‹¾é¸</p>
        </div>`;
      $list.appendChild(empty);
      return;
    }

    items.forEach((it, idx) => {
      const row = document.createElement("div");
      row.className = "row checkRow" + (it.done ? " row--soft" : "");
      row.innerHTML = `
        <div class="row__icon">${it.done ? "âœ…" : "ğŸ›’"}</div>
        <input type="checkbox" ${it.done ? "checked" : ""} aria-label="done" />
        <div class="row__body">
          <p class="row__title">${escapeHtml(it.name)}</p>
          <p class="row__meta">${it.note ? escapeHtml(it.note) : "â€”"}</p>
        </div>
        <div class="badges">
          ${it.done ? `<span class="badge">å·²è²·åˆ°</span>` : `<span class="badge">å¾…è³¼è²·</span>`}
          <button class="btn secondary" data-del="${it.id}">åˆªé™¤</button>
        </div>
      `;

      const checkbox = row.querySelector('input[type="checkbox"]');
      checkbox.addEventListener("change", () => {
        items = items.map(x => x.id === it.id ? { ...x, done: checkbox.checked } : x);
        save(items);
        render();
      });

      const delBtn = row.querySelector('button[data-del]');
      delBtn.addEventListener("click", () => {
        items = items.filter(x => x.id !== it.id);
        save(items);
        render();
      });

      $list.appendChild(row);
    });
  }

  function addItem() {
    const name = $itemName.value.trim();
    const note = $itemNote.value.trim();
    if (!name) return;

    items.unshift({ id: crypto.randomUUID(), name, note, done: false });
    save(items);
    $itemName.value = "";
    $itemNote.value = "";
    render();
  }

  $addBtn.addEventListener("click", addItem);
  $itemName.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addItem();
  });
  $itemNote.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addItem();
  });

  $clearDoneBtn.addEventListener("click", () => {
    items = items.filter(x => !x.done);
    save(items);
    render();
  });

  $resetAllBtn.addEventListener("click", () => {
    items = [...defaultItems];
    save(items);
    render();
  });

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  render();
</script>
</body>
</html>
